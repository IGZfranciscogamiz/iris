/*! Iris - v0.5.0 - 2012-11-27
* https://github.com/iris-js/iris.git
* Copyright (c) 2012 Iris; Licensed New-BSD */
(function(e,t){function L(){typeof jQuery=="undefined"?D("jQuery "+i+"+ previous load required"):e().jquery<i&&D("jQuery "+e().jquery+" currently loaded, jQuery "+i+"+ required"),N=t.console&&t.console.debug&&t.console.warn&&t.console.error,!N&&t.console&&t.console.log&&t.console.log("advanced console debugging is not supported in this browser")}function A(e){return o[e]}function O(){N&&t.console.log&&t.console.log(u,arguments)}function M(){N&&A("debug")&&t.console.debug(u,arguments)}function _(){N&&A("warning")&&t.console.warn(u,arguments)}function D(){N&&A("error")&&t.console.error(u,arguments)}function P(e){h=document.location.hash,document.location.hash=e}function H(){if(!k)return n.E("You must set the welcome screen using iris.screen.WelcomeScreen()"),!1;n.event.Notify(n.event.BEFORE_NAVIGATION);if(C)return C=!1,!1;var e=h.split("/"),t=document.location.hash.split("/"),r="",i="",s,o=!1,u;if(h!=="")for(u=0;u<e.length;u++)if(e[u]!==""){r+=e[u]+"/",s=B(r);if(a.hasOwnProperty(s)&&a[s].CanSleep()===!1)return C=!0,document.location.hash=h,!1}r="";if(e.length>t.length)for(u=0;u<e.length;u++){r+=e[u]+"/",t[u]&&(i+=t[u]+"/");if(o||i!==r)o=!0,s=B(r),a[s].__Sleep__(),a[s].Hide()}r="",i="",o=!1;for(u=0;u<t.length;u++){i+=t[u]+"/",e[u]&&(r+=e[u]+"/");if(o||i!==r)o=!0,s=B(i),mt(s,F(t[u]))}h=j(i)}function B(e){return j(e.replace(/\?[^\/]*/,""))}function j(e){return e.replace(/\/$/,"")}function F(e){var t={},n=/([\.\w_\-]*)=([^&]*)/g,r=n.exec(e);while(r)t[r[1]]=decodeURIComponent(r[2]),r=n.exec(e);return t}function I(e){if(e!==undefined)E=e;else{var t=document.getElementsByTagName("base");t=t.length>0?t[0].attributes.href.value:"/",E=document.location.protocol+"//"+document.location.host+t}return E}function q(t){return e.ajax(t)}function R(t,n,i,s){var o={url:t,dataType:n,async:!1,cache:T,success:i,error:s};T&&r!==undefined&&(o.data="_="+r),e.ajax(o)}function U(e){r=e}function z(){for(var e=0,t=arguments.length;e<t;e++)W(arguments[e])}function W(e){if(!b.hasOwnProperty(e)){b[e]=!0;var t=e.indexOf("http")===0?e:I()+e;M("[iris.ui.Include]",t);if(e.lastIndexOf(".css")>-1){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href=t,x.appendChild(n)}else{var r=e.lastIndexOf(".html")>-1;R(t,r?"html":"text",function(t){S=e;if(r)b[e]=st(t);else{var n=document.createElement("script");n.language="javascript",n.type="text/javascript",n.text=t,x.appendChild(n)}},function(e){delete b[t],D(e.status,"Error loading file '"+t+"'")})}}}function X(t){if(t){e.extend(m,t),$(m.global);var n=V();if(m.log){var r=m.log[n],i=r.split(",");for(var s=0;s<i.length;s++)o[e.trim(i[s])]=!0}T=!0;if(m.hasOwnProperty("environments-nocache")){var u=m["environments-nocache"].split(",");for(var a=0,f=u.length;a<f;a++)if(u[a]===n){T=!1;break}}K(m.local)}return m}function V(e){if(e===undefined){if(!s){s=m["environment-default"];for(var t in m.environment)if(document.location.href.indexOf(t)>-1){s=m.environment[t];break}s||(s="pro"),u="["+s+"]"}return s}s=e}function $(t){return e.extend(p,t),p}function J(e,t){if(!e||t===undefined)return e?p[e]:p;p[e]=t}function K(t){return e.extend(d,t),d}function Q(e,t){if(!e||t===undefined)return e?d[e][V()]:d;d[e][V()]=t}function G(e,t){var n=y[e];if(n)for(var r=0,i=n.length;r<i;r++)if(n[r]===t)return r;return-1}function Y(e,t){y[e]||(y[e]=[]);var n=G(e,t);n===-1&&(n=y[e].length),y[e][n]=t}function Z(e,t){var n=G(e,t);n!==-1&&y[e].splice(n,1)}function et(e,t){if(y[e]){var n=y[e];for(var r=0,i=n.length;r<i;r++)n[r](t)}}function tt(e,t){var n;if(t.indexOf(".")>-1){var r=t.split("."),i,s=r.length;for(i=0;i<s;i++){if(e===undefined)break;e=e[r[i]]}n=e}else n=e[t];return n}function nt(t,n){M("[iris.lang.Load]",t,n),v===null&&(v=t),g.hasOwnProperty(t)||(g[t]={}),e.extend(g[t],n)}function rt(e){var t;return g.hasOwnProperty(v)?(t=tt(g[v],e),t===undefined&&n.W("Label '"+e+"' not found in Locale '"+v+"'",g[v]),typeof t=="object"&&n.W("Label '"+e+"' is an object but must be a property in Locale '"+v+"'",g[v])):n.W("Locale '"+v+"' not loaded"),t?t:"??"+e+"??"}function it(e){if(e===undefined)return v;v=e}function st(e){var t=e,n=t.match(/@@[A-Za-z_\.]+@@/g);if(n){var r,i=n.length;for(r=0;r<i;r++)t=t.replace(n[r],rt(n[r].substring(2,n[r].length-2)))}return t}function ot(e,t,n){M("[iris.lang.LoadFrom]",e,t),R(t,"json",function(t){nt(e,t),M("[iris.lang.LoadFrom] loaded",t),n&&n.hasOwnProperty("success")&&n.success(e)},function(r){D(r.status,"Error loading lang file",t),n&&n.hasOwnProperty("error")&&n.error(e)})}function ut(e,t,n){var r=t.get(0);if(n){var i;for(var s=0,o=n.length;s<o;s++)i=e[n[s]],i&&r.setAttribute(n[s],i)}else for(var u in e)e.hasOwnProperty(u)&&r.setAttribute(u,e[u]);return t}function at(e){var t={},n=e.get(0).attributes,r;for(var i=0,s=n.length;i<s;i++)r=n[i].name,r.indexOf("data-")===0&&(r=r.substr(5)),t[r]=n[i].value;return t}function ft(e,t,n){W(e);var r=new Lt;return r.__Components__=[],r.settings={},w[e](r),r.Settings(n),r.AddAll(t),r.Create(),r}function lt(e){w[S]=e}function ct(e){b[S]=e}function ht(t,n,r,i,s){W(r);var o=new At;b[r](o),o.__Id__=n,o.__Element__={},o.__$Container__=t,o.__UIComponents__=[],o.settings={},o.__FileJs__=r,s!==undefined&&(o.__TemplateMode__=s),i=i===undefined?{}:i;var u=at(t);return e.extend(o.settings,u,i),o.Create(u,i),o}function pt(e){e.prototype=new Ot,b[S]=e}function dt(e){var t=f[e];W(t);var n=new Ot;b[t](n),n.__Id__=e,n.__Element__={},n.__UIComponents__=[],n.__$Container__=l[e],n.__FileJs__=t,n.Create(),n.Hide(),a[e]=n}function vt(e){if(a.hasOwnProperty(e)){var t=a[e].$Get().parent().data("screen_context");c[t]===a[e]&&delete c[t],a[e].__Destroy__(),a[e].$Get().remove(),delete a[e]}else n.W('Error removing the screen "'+e+'", path not found.')}function mt(e,t){if(!l.hasOwnProperty(e))D("Screen '"+e+"' must be registered with self.AddScreen() before go to");else{a.hasOwnProperty(e)||dt(e);var n=a[e],r=n.$Get().parent().data("screen_context");if(c.hasOwnProperty(r)){var i=c[r];i.__Sleep__(),i.Hide()}n.__Awake__(t?t:{}),n.Show(),c[r]=n}}function gt(n){W(n);var r=new Ot;b[n](r),r.__Id__="welcome-screen",r.__Element__={},r.__UIComponents__=[],r.__$Container__=e(document.body),r.__FileJs__=n,r.Create(),r.__Awake__(),r.Show(),k=!0,"onhashchange"in t?(document.location.hash&&H(),e(t).bind("hashchange",H)):D("The browser doesn't support the hashchange event")}function yt(e,t,r){var i=e,s,o,u=/##([0-9A-Za-z_\.]+)(?:\|(date|currency)(?:\(([^\)]+)\))*)?##/g,a=u.exec(e);while(a){o=tt(t,a[1]);if(o!==undefined){s=a[2];if(s)switch(s){case"date":o=wt(o,a[3]);break;case"currency":o=bt(o);break;default:n.W("Unknow template format label '"+s+"' in '"+r+"'")}}else n.W("Template param '"+a[1]+"' in '"+r+"' not found",t);i=i.replace(a[0],o),a=u.exec(e)}return i}function bt(e){var t=Et("currency"),n=Number(e),r=n>=0?t.formatPos:t.formatNeg,i=n%1,s=String(Math.abs(n-i));i=String(Math.abs(i).toFixed(t.precision)),i=i.substr(2);for(var o=0;o<Math.floor((s.length-(1+o))/3);o++)s=s.substring(0,s.length-(4*o+3))+t.thousand+s.substring(s.length-(4*o+3));return r.replace("n",s+t.decimal+i)}function wt(e,t){t||(t=Et("dateFormat")),typeof e!="object"&&(e=new Date(Number(e)));var n="";for(var r=0,i=t.length;r<i;r++)n+=xt(t[r],e);return n}function Et(e){if(Tt.hasOwnProperty(v)){if(Tt[v].hasOwnProperty(e))return Tt[v][e];n.E("Regional setting '"+e+"' not found for locale '"+v+"'")}else n.E("Regional for locale '"+v+"' not found")}function St(e){return e<10?"0"+e:e}function xt(e,t){var n=Tt[v];switch(e){case"y":return String(t.getFullYear()).substring(2);case"Y":return t.getFullYear();case"m":var r=t.getMonth()+1;return St(r);case"n":return t.getMonth()+1;case"M":return n.monthNames[t.getMonth()].substring(0,3);case"b":return n.monthNames[t.getMonth()].substring(0,3).toLowerCase();case"F":return n.monthNames[t.getMonth()];case"d":var i=t.getDate();return St(i);case"D":return n.dayNames[t.getDay()].substring(0,3);case"l":return n.dayNames[t.getDay()];case"s":var s=t.getSeconds();return St(s);case"i":var o=t.getMinutes();return St(o);case"H":var u=t.getHours();return St(u);case"h":var a=t.getHours();return a=a%12===0?12:a%12,St(a);case"a":return t.getHours()>12?"p.m.":"a.m.";case"A":return t.getHours()>12?"PM":"AM";case"U":return Math.floor(t.getTime()*.001);default:return e}}function Nt(e,t){Tt[e]=t}function _t(e){var t=new Mt;return e(t),t}function Dt(t,n){var r,i,s;for(var o in n)if(n.hasOwnProperty(o)){r=t.find('[name="'+o+'"]');if(r.length>0){i=r[0].tagName.toLowerCase(),s=n[o];switch(i){case"select":case"textarea":e(r).val(s);break;case"input":switch(i){case"checkbox":s&&r.attr("checked","checked");break;case"radio":r.filter('[value="'+s+'"]').attr("checked","checked");break;default:r.val(s)}}}}}function Pt(t){var n={};return e.map(t.serializeArray(),function(e){n[e.name]=e.value}),n}var n={event:{},config:{},net:{},global:{},local:{},lang:{},util:{}};t.iris=n;var r,i=1.5,s=null,o={error:!0},u="",a={},f={},l={},c={},h="",p={},d={},v=null,m={},g={},y={},b={},w={},E="",S,x=e("head").get(0),T=!0,N,C=!1,k=!1,Tt={"en-US":{dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],dateFormat:"m/d/Y h:i:s",currency:{formatPos:"n",formatNeg:"(n)",decimal:".",thousand:",",precision:2}},"es-ES":{dayNames:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],dateFormat:"d/m/Y H:i:s",currency:{formatPos:"n",formatNeg:"-n",decimal:",",thousand:".",precision:2}}},Ct=function(){this.settings=null};Ct.prototype.Settings=function(t){return e.extend(this.settings,t)},Ct.prototype.Setting=function(e,t){if(t===undefined)return this.settings.hasOwnProperty(e)||n.W("The setting ",e," is not in ",this.settings,this),this.settings[e];this.settings[e]=t};var kt=function(){this.TEMPLATE_APPEND="append",this.TEMPLATE_REPLACE="replace",this.TEMPLATE_PREPEND="prepend",this.__$Tmpl__=null,this.__Id__=null,this.__UIComponents__=null,this.__$Container__=null,this.__IsSleeping__=null,this.__FileJs__=null,this.__FileTmpl__=null,this.__Element__=null};kt.prototype=new Ct,kt.prototype.__Sleep__=function(){for(var e=0,t=this.__UIComponents__.length;e<t;e++)this.__UIComponents__[e].__Sleep__();this.__IsSleeping__=!0,this.Sleep()},kt.prototype.__Awake__=function(e){for(var t=0,n=this.__UIComponents__.length;t<n;t++)this.__UIComponents__[t].__Awake__();this.__IsSleeping__=!1,this.Awake(e)},kt.prototype.__Destroy__=function(){this.__IsSleeping__||this.__Sleep__();for(var e=0,t=this.__UIComponents__.length;e<t;e++)this.__UIComponents__[e].__Destroy__();this.__UIComponents__=null,this.Destroy()},kt.prototype.__Template__=function(t,r,i){this.__FileTmpl__=t;if(typeof t=="undefined")return this.__$Tmpl__=this.__$Container__,this.__$Tmpl__;n.Include(t);var s=r?yt(b[t],r,t):b[t],o=e(s);this.__$Tmpl__=o,o.size()>1&&n.E("Template '"+t+"' must have only one root node");switch(i){case this.TEMPLATE_APPEND:this.__$Container__.append(o);break;case this.TEMPLATE_REPLACE:this.__$Container__.replaceWith(o);break;case this.TEMPLATE_PREPEND:this.__$Container__.prepend(o);break;default:n.E("Unknown template mode '"+i+"'")}},kt.prototype.__CheckTmpl__=function(){if(this.__$Tmpl__===null)return n.E("You must set a template using self.Template() in '"+this.__FileJs__+"'"),undefined},kt.prototype.Show=function(){this.__CheckTmpl__(),this.__$Tmpl__.show()},kt.prototype.Hide=function(){this.__CheckTmpl__(),this.__$Tmpl__.hide()},kt.prototype.$Get=function(e){this.__CheckTmpl__();if(e){if(!this.__Element__.hasOwnProperty(e)){var t="[data-id="+e+"]",r=this.__$Tmpl__.filter(t),i=null;if(r.length>0)i=r;else{var s=this.__$Tmpl__.find(t);s.size()>0&&(i=s)}if(i===null)return n.E("[data-id="+e+"] not found in '"+this.__FileTmpl__+"' used by '"+this.__FileJs__+"'"),undefined;if(i.size()>1)return n.E("[data-id="+e+"] must be unique in '"+this.__FileTmpl__+"' used by '"+this.__FileJs__+"'"),undefined;this.__Element__[e]=i}return this.__Element__[e]}return this.__$Tmpl__},kt.prototype.InstanceUI=function(e,t,n,r){var i=this.$Get(e);if(i.size()===1){var s=ht(i,i.data("id"),t,n,r);return this.__UIComponents__[this.__UIComponents__.length]=s,s}},kt.prototype.DestroyUI=function(e){for(var t=0,n=this.__UIComponents__.length;t<n;t++)if(this.__UIComponents__[t]===e){this.__UIComponents__.splice(t,1),e.__Destroy__(),e.$Get().remove();break}},kt.prototype.DestroyAllUIs=function(e){var t=typeof e=="string"?"[data-id="+e+"]":e.selector,n;for(var r=0,i=this.__UIComponents__.length;r<i;r++)n=this.__UIComponents__[r],n.__$Container__.selector===t&&(this.__UIComponents__.splice(r--,1),i--,n.__Destroy__(),n.$Get().remove())},kt.prototype.$Container=function(){return this.__$Container__},kt.prototype.Create=function(){},kt.prototype.Awake=function(){},kt.prototype.CanSleep=function(){return!0},kt.prototype.Sleep=function(){},kt.prototype.Destroy=function(){};var Lt=function(){this.__Components__=null};Lt.prototype=new Ct,Lt.prototype.AddAll=function(e){for(var t=0,n=e.length;t<n;t++)this.Add(e[t])},Lt.prototype.Add=function(e){this.hasOwnProperty("UIAddOn")&&this.UIAddOn(e),this.__Components__[this.__Components__.length]=e},Lt.prototype.Remove=function(e){var t;for(var n=0,r=this.__Components__.length;n<r;n++)t=this.__Components__[n],t===e&&this.__Components__.splice(n,1)},Lt.prototype.Get=function(e){return this.__Components__[e]},Lt.prototype.Size=function(){return this.__Components__.length},Lt.prototype.Create=function(){};var At=function(){this.__TemplateMode__="replace"};At.prototype=new kt,At.prototype.TemplateMode=function(e){this.__TemplateMode__=e},At.prototype.Template=function(e,t){this.__Template__(e,t,this.__TemplateMode__)};var Ot=function(){};Ot.prototype=new kt,Ot.prototype.Template=function(e,t){this.__Template__(e,t,this.TEMPLATE_APPEND)},Ot.prototype.AddScreen=function(e,t,n){var r=this.$Get(e);r.data("screen_context")===undefined&&r.data("screen_context",this.__Id__+"|"+e),f[t]=n,l[t]=r};var Mt=function(){this.type="json",this.path=""};Mt.prototype.ajax=function(e,t,r,i,s){var o=this.path+t;n.net.Ajax({url:o,type:e,data:r,cache:!1,dataType:this.type,async:!0,success:i,error:s})},Mt.prototype.get=function(e,t,n,r){this.ajax("GET",e,t,n,r)},Mt.prototype.put=function(e,t,n,r){this.ajax("PUT",e,t,n,r)},Mt.prototype.post=function(e,t,n,r){this.ajax("POST",e,t,n,r)},Mt.prototype.del=function(e,t,n,r){this.ajax("DELETE",e,t,n,r)},n.screen={},n.event={},n.config={},n.ui={},n.net={},n.global={},n.local={},n.lang={},n.util={},n.config.Load=X,n.config.Env=V,n.global.Load=$,n.global.Data=J,n.local.Load=K,n.local.Data=Q,n.lang.Load=nt,n.lang.LoadFrom=ot,n.lang.Get=rt,n.lang.Locale=it,n.L=O,n.D=M,n.W=_,n.E=D,n.event.BEFORE_NAVIGATION="iris_before_navigation",n.event.Subscribe=Y,n.event.Notify=et,n.event.Remove=Z,n.net.BaseUri=I,n.net.Ajax=q,n.net.CacheVersion=U,n.Screen=pt,n.service=_t,n.UI=ct,n.screen.WelcomeScreen=gt,n.screen.Destroy=vt,n.ui.JqToHash=at,n.ui.HashToJq=ut,n.Include=z,n.util.DateFormat=wt,n.util.Currency=bt,n.util.Deserialize=Dt,n.util.Serialize=Pt,n.Goto=P,n.AddOn=lt,n.ApplyAddOn=ft,n.Regional=Nt,L()})(jQuery,window);