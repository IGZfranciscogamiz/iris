/*! Iris - v0.5.0 - 2012-11-29
* https://github.com/iris-js/iris.git
* Copyright (c) 2012 Iris; Licensed New-BSD */
(function(e,t){function k(n){typeof jQuery=="undefined"?_("jQuery "+r+"+ previous load required"):e().jquery<r&&_("jQuery "+e().jquery+" currently loaded, jQuery "+r+"+ required"),T=t.console&&t.console.debug&&t.console.warn&&t.console.error,!T&&t.console&&t.console.log&&t.console.log("advanced console debugging is not supported in this browser"),z(n);var i=new Ot;y[n](i),i.id="welcome-screen",i.el={},i.uis=[],i.con=e(document.body),i.fileJs=n,i.Create(),i._awake(),i.Show(),C=!0,"onhashchange"in t?(document.location.hash&&P(),e(t).bind("hashchange",P)):_("The browser doesn't support the hashchange event")}function L(e){return s[e]}function A(){T&&t.console.log&&t.console.log(o,arguments)}function O(){T&&L("debug")&&t.console.debug(o,arguments)}function M(){T&&L("warning")&&t.console.warn(o,arguments)}function _(){T&&L("error")&&t.console.error(o,arguments)}function D(e){c=document.location.hash,document.location.hash=e}function P(){if(!C)return Mt.e("You must set the welcome screen using iris.screen.WelcomeScreen()"),!1;Mt.event.Notify(Mt.event.BEFORE_NAVIGATION);if(N)return N=!1,!1;var e=c.split("/"),t=document.location.hash.split("/"),n="",r="",i,s=!1,o;if(c!=="")for(o=0;o<e.length;o++)if(e[o]!==""){n+=e[o]+"/",i=H(n);if(u.hasOwnProperty(i)&&u[i].CanSleep()===!1)return N=!0,document.location.hash=c,!1}n="";if(e.length>t.length)for(o=0;o<e.length;o++){n+=e[o]+"/",t[o]&&(r+=t[o]+"/");if(s||r!==n)s=!0,i=H(n),u[i]._sleep(),u[i].Hide()}n="",r="",s=!1;for(o=0;o<t.length;o++){r+=t[o]+"/",e[o]&&(n+=e[o]+"/");if(s||r!==n)s=!0,i=H(r),gt(i,j(t[o]))}c=B(r)}function H(e){return B(e.replace(/\?[^\/]*/,""))}function B(e){return e.replace(/\/$/,"")}function j(e){var t={},n=/([\.\w_\-]*)=([^&]*)/g,r=n.exec(e);while(r)t[r[1]]=decodeURIComponent(r[2]),r=n.exec(e);return t}function F(e){if(e!==undefined)w=e;else{var t=document.getElementsByTagName("base");t=t.length>0?t[0].attributes.href.value:"/",w=document.location.protocol+"//"+document.location.host+t}return w}function I(t){return e.ajax(t)}function q(t,r,i,s){var o={url:t,dataType:r,async:!1,cache:x,success:i,error:s};x&&n!==undefined&&(o.data="_="+n),e.ajax(o)}function R(e){n=e}function U(){for(var e=0,t=arguments.length;e<t;e++)z(arguments[e])}function z(e){if(!y.hasOwnProperty(e)){y[e]=!0;var t=e.indexOf("http")===0?e:F()+e;O("[iris.ui.Include]",t);if(e.lastIndexOf(".css")>-1){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href=t,S.appendChild(n)}else{var r=e.lastIndexOf(".html")>-1;q(t,r?"html":"text",function(t){E=e;if(r)y[e]=it(t);else{var n=document.createElement("script");n.language="javascript",n.type="text/javascript",n.text=t,S.appendChild(n)}},function(e){delete y[t],_(e.status,"Error loading file '"+t+"'")})}}}function W(t){if(t){e.extend(v,t),V(v.global);var n=X();if(v.log){var r=v.log[n],i=r.split(",");for(var o=0;o<i.length;o++)s[e.trim(i[o])]=!0}x=!0;if(v.hasOwnProperty("environments-nocache")){var u=v["environments-nocache"].split(",");for(var a=0,f=u.length;a<f;a++)if(u[a]===n){x=!1;break}}K(v.local)}return v}function X(e){if(e===undefined){if(!i){i=v["environment-default"];for(var t in v.environment)if(document.location.href.indexOf(t)>-1){i=v.environment[t];break}i||(i="pro"),o="["+i+"]"}return i}i=e}function V(t){return e.extend(h,t),h}function $(e,t){if(!e||t===undefined)return e?h[e]:h;h[e]=t}function J(e,t){typeof e=="object"?V(e):$(e,t)}function K(t){return e.extend(p,t),p}function Q(e,t){if(!e||t===undefined)return e?p[e][X()]:p;p[e][X()]=t}function G(e,t){typeof e=="object"?K(e):Q(e,t)}function Y(e,t){var n=g[e];if(n)for(var r=0,i=n.length;r<i;r++)if(n[r]===t)return r;return-1}function Z(e,t){g[e]||(g[e]=[]);var n=Y(e,t);n===-1&&(n=g[e].length),g[e][n]=t}function et(e,t){var n=Y(e,t);n!==-1&&g[e].splice(n,1)}function tt(e,t){if(g[e]){var n=g[e];for(var r=0,i=n.length;r<i;r++)n[r](t)}}function nt(e,t){var n;if(t.indexOf(".")>-1){var r=t.split("."),i,s=r.length;for(i=0;i<s;i++){if(e===undefined)break;e=e[r[i]]}n=e}else n=e[t];return n}function rt(e){if(e===undefined)return d;d=e}function it(e){var t=e,n=t.match(/@@[A-Za-z_\.]+@@/g);if(n){var r,i=n.length;for(r=0;r<i;r++)t=t.replace(n[r],ut(n[r].substring(2,n[r].length-2)))}return t}function st(e,t,n){if(typeof t=="undefined")return ut(e);typeof t=="object"?ot(e,t):at(e,t,n)}function ot(t,n){O("[add lang]",t,n),d===null&&(d=t),m.hasOwnProperty(t)||(m[t]={}),e.extend(m[t],n)}function ut(e){var t;return m.hasOwnProperty(d)?(t=nt(m[d],e),t===undefined&&Mt.w("Label '"+e+"' not found in Locale '"+d+"'",m[d]),typeof t=="object"&&Mt.w("Label '"+e+"' is an object but must be a property in Locale '"+d+"'",m[d])):Mt.w("Locale '"+d+"' not loaded"),t?t:"??"+e+"??"}function at(e,t,n){O("[iris.lang.LoadFrom]",e,t),q(t,"json",function(t){ot(e,t),O("[iris.lang.LoadFrom] loaded",t),n&&n.hasOwnProperty("success")&&n.success(e)},function(r){_(r.status,"Error loading lang file",t),n&&n.hasOwnProperty("error")&&n.error(e)})}function ft(e,t,n){z(e);var r=new Lt;return r._components=[],r.settings={},b[e](r),r.Settings(n),r.AddAll(t),r.Create(),r}function lt(e){b[E]=e}function ct(e){y[E]=e}function ht(t,n,r,i,s){z(r);var o=new At;y[r](o),o.id=n,o.el={},o.con=t,o.uis=[],o.settings={},o.fileJs=r,s!==undefined&&(o._tmplMode=s),i=i===undefined?{}:i;var u=pt(t);return e.extend(o.settings,u,i),o.Create(u,i),o}function pt(e){var t={},n=e.get(0).attributes,r;for(var i=0,s=n.length;i<s;i++)r=n[i].name,r.indexOf("data-")===0&&(r=r.substr(5)),t[r]=n[i].value;return t}function dt(e){e.prototype=new Ot,y[E]=e}function vt(e){var t=a[e];z(t);var n=new Ot;y[t](n),n.id=e,n.el={},n.uis=[],n.con=f[e],n.fileJs=t,n.Create(),n.Hide(),u[e]=n}function mt(e){if(u.hasOwnProperty(e)){var t=u[e].$Get().parent().data("screen_context");l[t]===u[e]&&delete l[t],u[e]._destroy(),u[e].$Get().remove(),delete u[e]}else Mt.w('Error removing the screen "'+e+'", path not found.')}function gt(e,t){if(!f.hasOwnProperty(e))_("Screen '"+e+"' must be registered with self.AddScreen() before go to");else{u.hasOwnProperty(e)||vt(e);var n=u[e],r=n.$Get().parent().data("screen_context");if(l.hasOwnProperty(r)){var i=l[r];i._sleep(),i.Hide()}n._awake(t?t:{}),n.Show(),l[r]=n}}function yt(e,t,n){var r=e,i,s,o=/##([0-9A-Za-z_\.]+)(?:\|(date|currency)(?:\(([^\)]+)\))*)?##/g,u=o.exec(e);while(u){s=nt(t,u[1]);if(s!==undefined){i=u[2];if(i)switch(i){case"date":s=wt(s,u[3]);break;case"currency":s=bt(s);break;default:Mt.w("Unknow template format label '"+i+"' in '"+n+"'")}}else Mt.w("Template param '"+u[1]+"' in '"+n+"' not found",t);r=r.replace(u[0],s),u=o.exec(e)}return r}function bt(e){var t=Et("currency"),n=Number(e),r=n>=0?t.formatPos:t.formatNeg,i=n%1,s=String(Math.abs(n-i));i=String(Math.abs(i).toFixed(t.precision)),i=i.substr(2);for(var o=0;o<Math.floor((s.length-(1+o))/3);o++)s=s.substring(0,s.length-(4*o+3))+t.thousand+s.substring(s.length-(4*o+3));return r.replace("n",s+t.decimal+i)}function wt(e,t){t||(t=Et("dateFormat")),typeof e!="object"&&(e=new Date(Number(e)));var n="";for(var r=0,i=t.length;r<i;r++)n+=xt(t[r],e);return n}function Et(e){if(Tt.hasOwnProperty(d)){if(Tt[d].hasOwnProperty(e))return Tt[d][e];Mt.e("Regional setting '"+e+"' not found for locale '"+d+"'")}else Mt.e("Regional for locale '"+d+"' not found")}function St(e){return e<10?"0"+e:e}function xt(e,t){var n=Tt[d];switch(e){case"y":return String(t.getFullYear()).substring(2);case"Y":return t.getFullYear();case"m":var r=t.getMonth()+1;return St(r);case"n":return t.getMonth()+1;case"M":return n.monthNames[t.getMonth()].substring(0,3);case"b":return n.monthNames[t.getMonth()].substring(0,3).toLowerCase();case"F":return n.monthNames[t.getMonth()];case"d":var i=t.getDate();return St(i);case"D":return n.dayNames[t.getDay()].substring(0,3);case"l":return n.dayNames[t.getDay()];case"s":var s=t.getSeconds();return St(s);case"i":var o=t.getMinutes();return St(o);case"H":var u=t.getHours();return St(u);case"h":var a=t.getHours();return a=a%12===0?12:a%12,St(a);case"a":return t.getHours()>12?"p.m.":"a.m.";case"A":return t.getHours()>12?"PM":"AM";case"U":return Math.floor(t.getTime()*.001);default:return e}}function Nt(e,t){Tt[e]=t}var n,r=1.5,i=null,s={error:!0},o="",u={},a={},f={},l={},c="",h={},p={},d=null,v={},m={},g={},y={},b={},w="",E,S=e("head").get(0),x=!0,T,N=!1,C=!1,Tt={"en-US":{dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],dateFormat:"m/d/Y h:i:s",currency:{formatPos:"n",formatNeg:"(n)",decimal:".",thousand:",",precision:2}},"es-ES":{dayNames:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],dateFormat:"d/m/Y H:i:s",currency:{formatPos:"n",formatNeg:"-n",decimal:",",thousand:".",precision:2}}},Ct=function(){this.settings=null};Ct.prototype.Settings=function(t){return e.extend(this.settings,t)},Ct.prototype.Setting=function(e,t){if(t===undefined)return this.settings.hasOwnProperty(e)||Mt.w("The setting ",e," is not in ",this.settings,this),this.settings[e];this.settings[e]=t};var kt=function(){this.TEMPLATE_APPEND="append",this.TEMPLATE_REPLACE="replace",this.TEMPLATE_PREPEND="prepend",this._$tmpl=null,this.id=null,this.uis=null,this.con=null,this._sleeping=null,this.fileJs=null,this.fileTmpl=null,this.el=null};kt.prototype=new Ct,kt.prototype._sleep=function(){for(var e=0,t=this.uis.length;e<t;e++)this.uis[e]._sleep();this._sleeping=!0,this.Sleep()},kt.prototype._awake=function(e){for(var t=0,n=this.uis.length;t<n;t++)this.uis[t]._awake();this._sleeping=!1,this.Awake(e)},kt.prototype._destroy=function(){this._sleeping||this._sleep();for(var e=0,t=this.uis.length;e<t;e++)this.uis[e]._destroy();this.uis=null,this.Destroy()},kt.prototype._tmpl=function(t,n,r){this.fileTmpl=t;if(typeof t=="undefined")return this._$tmpl=this.con,this._$tmpl;Mt.Include(t);var i=n?yt(y[t],n,t):y[t],s=e(i);this._$tmpl=s,s.size()>1&&Mt.e("Template '"+t+"' must have only one root node");switch(r){case this.TEMPLATE_APPEND:this.con.append(s);break;case this.TEMPLATE_REPLACE:this.con.replaceWith(s);break;case this.TEMPLATE_PREPEND:this.con.prepend(s);break;default:Mt.e("Unknown template mode '"+r+"'")}},kt.prototype._checkTmpl=function(){if(this._$tmpl===null)return Mt.e("You must set a template using self.Template() in '"+this.fileJs+"'"),undefined},kt.prototype.Show=function(){this._checkTmpl(),this._$tmpl.show()},kt.prototype.Hide=function(){this._checkTmpl(),this._$tmpl.hide()},kt.prototype.$Get=function(e){this._checkTmpl();if(e){if(!this.el.hasOwnProperty(e)){var t="[data-id="+e+"]",n=this._$tmpl.filter(t),r=null;if(n.length>0)r=n;else{var i=this._$tmpl.find(t);i.size()>0&&(r=i)}if(r===null)return Mt.e("[data-id="+e+"] not found in '"+this.fileTmpl+"' used by '"+this.fileJs+"'"),undefined;if(r.size()>1)return Mt.e("[data-id="+e+"] must be unique in '"+this.fileTmpl+"' used by '"+this.fileJs+"'"),undefined;this.el[e]=r}return this.el[e]}return this._$tmpl},kt.prototype.InstanceUI=function(e,t,n,r){var i=this.$Get(e);if(i.size()===1){var s=ht(i,i.data("id"),t,n,r);return this.uis[this.uis.length]=s,s}},kt.prototype.DestroyUI=function(e){for(var t=0,n=this.uis.length;t<n;t++)if(this.uis[t]===e){this.uis.splice(t,1),e._destroy(),e.$Get().remove();break}},kt.prototype.DestroyAllUIs=function(e){var t=typeof e=="string"?"[data-id="+e+"]":e.selector,n;for(var r=0,i=this.uis.length;r<i;r++)n=this.uis[r],n.con.selector===t&&(this.uis.splice(r--,1),i--,n._destroy(),n.$Get().remove())},kt.prototype.$Container=function(){return this.con},kt.prototype.Create=function(){},kt.prototype.Awake=function(){},kt.prototype.CanSleep=function(){return!0},kt.prototype.Sleep=function(){},kt.prototype.Destroy=function(){};var Lt=function(){this._components=null};Lt.prototype=new Ct,Lt.prototype.AddAll=function(e){for(var t=0,n=e.length;t<n;t++)this.Add(e[t])},Lt.prototype.Add=function(e){this.hasOwnProperty("UIAddOn")&&this.UIAddOn(e),this._components[this._components.length]=e},Lt.prototype.Remove=function(e){var t;for(var n=0,r=this._components.length;n<r;n++)t=this._components[n],t===e&&this._components.splice(n,1)},Lt.prototype.Get=function(e){return this._components[e]},Lt.prototype.Size=function(){return this._components.length},Lt.prototype.Create=function(){};var At=function(){this._tmplMode="replace"};At.prototype=new kt,At.prototype.TemplateMode=function(e){this._tmplMode=e},At.prototype.Template=function(e,t){this._tmpl(e,t,this._tmplMode)};var Ot=function(){};Ot.prototype=new kt,Ot.prototype.Template=function(e,t){this._tmpl(e,t,this.TEMPLATE_APPEND)},Ot.prototype.AddScreen=function(e,t,n){var r=this.$Get(e);r.data("screen_context")===undefined&&r.data("screen_context",this.id+"|"+e),a[t]=n,f[t]=r};var Mt={config:W,env:X,global:J,local:G,lang:st,locale:rt,l:A,d:O,w:M,e:_,BEFORE_NAVIGATION:"iris_before_navigation",notify:tt,on:Z,off:et,baseUri:F,ajax:I,cacheVersion:R,include:U,screen:dt,ui:ct,regional:Nt,welcome:k,"goto":D,destroyScreen:mt,date:wt,currency:bt,addOn:lt,applyAddOn:ft};t.iris=Mt})(jQuery,window),function(){function n(e){var n=new t;return e(n),n}var e=window.iris,t=function(){this.type="json",this.path=""};t.prototype.ajax=function(t,n,r,i,s){e.ajax({url:this.path+n,type:t,data:r,cache:!1,dataType:this.type,async:!0,success:i,error:s})},t.prototype.get=function(e,t,n){this.ajax("GET",e,null,t,n)},t.prototype.del=function(e,t,n){this.ajax("DELETE",e,null,t,n)},t.prototype.put=function(e,t,n,r){this.ajax("PUT",e,t,n,r)},t.prototype.post=function(e,t,n,r){this.ajax("POST",e,t,n,r)},e.service=n}(jQuery,window);